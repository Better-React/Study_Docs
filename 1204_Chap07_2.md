# Chap.07 CDN

## 7.4 전달 경로 최적화

> 모바일 애플리케이션의 중요성 강조, API 호출이 속도를 증가시키는 주요 해결책으로 대두됨. 전달경로 최적화는 어플 응답 속도를 빠르게 하는 기능. 빠른 길을 찾는 과정이라고 생각.

1. 라스트 마일 최적화
   > 최종 사용자 요청을 사용자와 가장 가까운 곳에 있는 에지 서버로 전송하는 일

- dns 기반 에지 선택
  : 사용자와 가장 가까운 dns 서버가 배정되도록 최적화 됨. 매우 기본적이고 안정적으로 사용된다는 장점. 사용자가 직접 특정 dns 서버 지정 사용시 의도하지 않은 에지 서버가 선택될 수 있음.

- 애니캐스트 기반 에지 선택
  : 네트워크상에서 원하는 IP 주소로 데이터를 전송하는 방식 중 하나. 1:1 전송 방식이며, 다수의 노드가 동일한 IP 주소를 가짐. 실 사용자와 가장 가까운 네트워크의 에지 서버가 선택된다는 장점(실제 물리적 거리에 따른 가까움이 아닌, ISP 계약 관계에 따른 최적 경로 결정). 서버 장애시 자동 우회하므로 가용성도 보장.

2. 프로토콜 최적화

> 사용자 기기와 원본 서버 간 웹 트래픽 가속화를 위해서 경로 최적화 + 프로토콜 최적화 병행 필요. 프로토콜 최적화는 한 번에 많은 트래픽을 보낼 수 있도록 길을 넓히는 작업.

> 가능한 많은 패킷을 한번에 보내는 것이 유리하나, 보낸다 해도 전부 다 받을 수 있는것은 아니므로 송신측은 수신측의 윈도우 사이즈(수신 가능한 데이터 크기)를 고려해 그보다 더 적은 양의 데이터를 보내고, 수신측은 윈도우 사이즈 크기를 서버에 통지함.

- TCP 최적화
  : 느린 시작 알고리즘을 사용. (송신 측이 전송 시작할 때 적은 양의 데이터부터 전송하는 것. =혼잡 윈도우)
- TLS 종료와 TCP 연결 재사용
  : HTTP 통신을 할 때 TLS handshake는 최정 사용자와 CDN 사이, CDN과 원본서버 사이에 한 번씩 발생함. TCP 연결을 바로 끊지 않고 재사용하면, 사용자 수만큼 TCP 연결할 필요 없이 에지 수만큼 TCP를 연결. 서버 자원을 아낄 수 있음.

## 7.5 기타 성능 옵션

1. CDN이 제공하는 기본 기능

- http 압축 : 텍스트파일 전송시에 매우 중요한 역할. 대부분 gzip 압축 방식을 지원. 웹 서버 설정을 통해 구현할 수 있다.
- 브라우저 캐시
- Html, css, 자바스크립트 최소화
- DNS 프리페치와 프리커넥트

2. 신기술 적용을 위한 CDN 기능

- http/2와 http/3
- 서버푸시
- Ipv6 듀얼 스택

## 읽어볼만한 글

- 3 way handshake : https://mindnet.tistory.com/entry/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-22%ED%8E%B8-TCP-3-WayHandshake-4-WayHandshake
